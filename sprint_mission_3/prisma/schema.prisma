generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//다시 image 넣어줘야한다.
model User {
  id            Int       @id @default(autoincrement())
  email         String    @unique
  nickname      String
  password      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  products      Product[]
  articles      Article[]
  comments      Comment[]
  productLikes  ProductLike[] // 유저가 상품들을 좋아요
  articleLikes  ArticleLike[] // 유저가 기사들을 좋아요
}

model Product {
  id          Int       @id @default(autoincrement())
  name        String
  description String
  price       Float
  tags        Tags
  imageUrl    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  comments    Comment[]
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  likes       ProductLike[] // 좋아요 목록
}

enum Tags {
  FASHION
  BEAUTY
  SPORTS
  ELECTRONICS
  HOME_INTERIOR
  HOUSEHOLD_SUPPLIES
  KITCHENWARE
}

model Article {
  id        Int       @id @default(autoincrement())
  title     String
  content   String
  imageUrl  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  comments  Comment[]
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  likes     ArticleLike[] // 좋아요 목록
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int?
  article   Article? @relation(fields: [articleId], references: [id], onDelete: Cascade)
  articleId Int?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
}
// 유저는 댓글을 여러개 달 수 있으니까 1:N으로 연결시키는게 맞다 생각

model ProductLike {
  id        Int       @id @default(autoincrement())
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int  
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int

  @@unique([userId, productId]) // 한 유저가 같은 상품에 중복 좋아요 금지 
}

model ArticleLike {
  id        Int       @id @default(autoincrement())
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  article   Article   @relation(fields: [articleId], references: [id], onDelete: Cascade)
  articleId Int

  @@unique([userId, articleId]) // 한 유저가 같은 기사에 중복 좋아요 금지 
}